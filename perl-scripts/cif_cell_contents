#! /bin/sh
#!perl -w # --*- Perl -*--
eval 'exec perl -x $0 ${1+"$@"}'
    if 0;
#------------------------------------------------------------------------------
#$Author$
#$Date$ 
#$Revision$
#$URL$
#------------------------------------------------------------------------------
#*
#  Calculate cell contents from atom coordinates and symmetry information.
#**

use strict;
use lib "./lib/perl5";
use lib "./CIFParser";
use lib "./Spacegroups";
use CIFData::CIFCellContents;
use CIFParser;
use CIFTagCanonicalNames;
use ShowStruct;
use Serialise;
use SymopParse;
use Fractional;
use File::Basename;
use SOptions;
use SUsage;

my $format = "%g";
my $Z_value;

#* Usage:
#*     cif_cell_constants [options] input.cif
#*
#* Options:
#*
#*     -Z, --cell-formula-units-Z  1
#*         Specify number of formula sum units in the unit cell.
#*         Default: taken from the input CIF if present, otherwise
#*         assumed to be 1.
#*
#*     --help  print a short usage message (this message) and exit.
#**

@ARGV = getOptions(

    "-Z,--cell-formula-units-Z" => \$Z_value,

    "--help,--usage" => sub { SUsage::usage; exit },
);

my $Id = '$Id$';

my $filename = shift(@ARGV);

my $parser = new CIFParser;

my $data = $parser->Run($filename);

for my $dataset (@$data) {

    canonicalize_names( $dataset );

    my $values = $dataset->{values};

    my $formula = CIFCellContents::cif_cell_contents( $dataset, 
						      $filename,
						      $Z_value );
    print $formula, "\n" if defined $formula;
}
