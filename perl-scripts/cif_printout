#! /bin/sh
#!perl -w # --*- Perl -*--
eval 'exec perl -x $0 ${1+"$@"}'
    if 0;
#------------------------------------------------------------------------------
#$Author$
#$Revision$
#$URL$
#$Date$
#$Id$
#------------------------------------------------------------------------------
#*
#  Parse CIF file and print out the structure generated by CIF parser
#**

use strict;
use lib "./lib/perl5";
use lib "./CIFParser";
use lib "./CCIFParser";
use lib "./CIFTags";
use CIFParser;
use CCIFParser;
use CIFDiff;
use SOptions;
use SUsage;

my $method = 'C';
@ARGV = getOptions(
    "-m,--method" => \$method
);

@ARGV = ( "-" ) unless @ARGV;

foreach( @ARGV ) {

    my $data;
    if( $method eq 'Perl' ) {
        my $parser = new CIFParser;
        $data = $parser->Run( $_ );
    } elsif( $method eq 'C' ) {
        $data = CCIFParser::parse( $_ );
    } else {
        die( "$0: unknown method: $method" );
    }

    foreach my $datablock ( @$data ) {
        print  $datablock->{name} . "\n";
        print "Values:\n";
        foreach my $tag ( sort { lc( $a ) cmp lc( $b ) } @{$datablock->{tags}} ) {
            print "    " . $tag . " ("
                . scalar( @{$datablock->{values}{$tag}} ) . ") ";
            print join( " ", map{ "[$_]" } @{$datablock->{values}{$tag}} )
                . "\n";
        }
        if( exists $datablock->{precisions} ) {
            print "Precisions:\n";
            foreach my $tag ( sort keys %{$datablock->{precisions}} ) {
                print "    " . $tag . " ("
                    . scalar( @{$datablock->{precisions}{$tag}} ) . ") ";
                print join( " ", map{ ( defined $_ ) ? $_ : "undef" }
                    @{$datablock->{precisions}{$tag}} ) . "\n";
            }
        }
        if( exists $datablock->{types} ) {
            print "Types:\n";
            foreach my $tag ( sort keys %{$datablock->{types}} ) {
                print "    " . $tag . " ";
                print join( " ", @{$datablock->{types}{$tag}} ) . "\n";
            }
        }
        print "Inloops:\n";
        foreach my $tag ( sort keys %{$datablock->{inloop}} ) {
            print "    " . $tag . " " . $datablock->{inloop}{$tag} . "\n";
        }
        print "Loops:\n";
        foreach my $loop ( @{$datablock->{loops}} ) {
            print join( " ", @$loop ) . "\n";
        }
    }
}
