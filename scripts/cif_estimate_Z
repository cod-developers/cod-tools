#! /bin/sh
#!perl -w # --*- Perl -*--
eval 'exec perl -x $0 ${1+"$@"}'
    if 0;
#------------------------------------------------------------------------------
#$Author$
#$Date$ 
#$Revision$
#$URL$
#------------------------------------------------------------------------------
#*
#  Calculate Z value (i.e. the number of "chemical fomula units" in the unit cell
#  using the provided cell volume, crystal density and molecular weight.
#**

use strict;
use warnings;
use COD::CIF::Parser qw(parse_cif);
use COD::UserMessage qw(error);
use COD::CIF::Data::EstimateZ;

@ARGV = ( "-" ) unless @ARGV;

for my $filename (@ARGV) {
    my $options = { parser => 'c', no_print => 1, fix_errors => 1 };
    my ( $data, $err_count, $messages ) = parse_cif( $filename, $options );

    if ( $err_count > 0 ) {
        print STDERR $_ foreach ( @$messages );
        error( $0, $filename, undef, "$err_count error(s) "
             . "encountered while parsing the file", undef );
        next;
    }
    print STDERR $_ foreach ( @$messages );

    for my $dataset (@$data) {
        eval {
            print cif_estimate_z( $dataset ), "\n";
        };
        if( $@ ) {
            print STDERR $@;
        }
    }
}
